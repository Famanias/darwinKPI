<div class="dashboard-container">
  <!-- Attention Required -->
  <div class="bg-yellow-100 p-4 rounded mb-4" *ngIf="attentionRequired">
    <span class="font-medium">Attention Required</span>
    <p>{{ attentionRequired }}</p>
  </div>

  <!-- Main Content with Widgets and Configuration -->
  <div class="dashboard-content">
    <!-- Widgets Area -->
    <div class="widgets-grid">
      <div *ngFor="let widget of widgets; let i = index" class="widget bg-white rounded shadow">
        <div class="widget-header">
          <h3 class="text-lg font-semibold">{{ widget.name }}</h3>
        </div>
        <div class="widget-content">
          <p><strong>Description:</strong> {{ widget.description }}</p>
          <p><strong>Target:</strong> {{ widget.target }} {{ widget.unit }}</p>
          <p><strong>Frequency:</strong> {{ widget.frequency }}</p>
          <div class="chart-container">
            <!-- <canvas #kpiChart [id]="'kpiChart-' + i"></canvas> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<!-- Dashboard Config Modal -->
<div class="config-modal-backdrop" *ngIf="showConfig" (click)="showConfig = false"></div>
<div class="config-modal" *ngIf="showConfig">
  <div class="config-panel bg-gray-100 p-4 rounded shadow" (click)="$event.stopPropagation()">
    <div class="flex justify-between items-center mb-2">
      <h3 class="text-lg font-semibold">Dashboard Configuration</h3>
      <button (click)="showConfig = false" class="close-btn" aria-label="Close">&times;</button>
    </div>
    <p class="text-sm text-gray-600 mb-4">Filter KPIs to display</p>
    <div class="config-list">
      <div *ngFor="let kpi of kpis; let i = index" class="config-item bg-white rounded p-2 mb-2">
        <input type="checkbox" [checked]="isKpiSelected(kpi.name)" (change)="toggleKpi(kpi.name)" class="mr-2">
        <span>{{ kpi.name }}</span>
      </div>
    </div>
  </div>
</div>

<div class="floating-buttons">
  <!-- Floating Settings Button -->
  <button class="floating-settings-btn" (click)="showConfig = true" aria-label="Dashboard Settings">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.03-2.11l1.42-1.42a1 1 0 0 0 0-1.41l-1.42-1.42a1 1 0 0 0-.71-.29h-2.02a7.03 7.03 0 0 0-.54-1.3l.96-1.66a1 1 0 0 0-.26-1.32l-1.66-.96a1 1 0 0 0-1.32.26l-.96 1.66a7.03 7.03 0 0 0-1.3-.54V4.7a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2.02a7.03 7.03 0 0 0-1.3.54l-.96-1.66a1 1 0 0 0-1.32-.26l-1.66.96a1 1 0 0 0-.26 1.32l.96 1.66a7.03 7.03 0 0 0-.54 1.3H4.7a1 1 0 0 0-1 1v2c0 .55.45 1 1 1h2.02c.12.45.29.88.54 1.3l-.96 1.66a1 1 0 0 0 .26 1.32l1.66.96a1 1 0 0 0 1.32-.26l.96-1.66c.42.25.85.42 1.3.54v2.02c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-2.02c.45-.12.88-.29 1.3-.54l.96 1.66a1 1 0 0 0 1.32.26l1.66-.96a1 1 0 0 0 .26-1.32l-.96-1.66c.25-.42.42-.85.54-1.3h2.02c.27 0 .52-.11.71-.29z" />
    </svg>
  </button>
  <!-- Floating Combined Chart Button -->
  <button class="floating-chart-btn" (click)="showCombinedChart = true" aria-label="Show Combined KPI Chart">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 17v-2a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v2" />
      <circle cx="12" cy="7" r="4" />
    </svg>
  </button>
</div>

<!-- Combined KPI Performance Chart Modal -->
<div *ngIf="showCombinedChart" (click)="showCombinedChart = false"></div>
<div class="config-modal-chart" *ngIf="showCombinedChart">
  <div (click)="$event.stopPropagation()">
    <div class="flex justify-between items-center mb-2">
      <h3 class="text-lg font-semibold">All KPI Performance Overview</h3>
      <button (click)="showCombinedChart = false" class="close-btn" aria-label="Close">&times;</button>
    </div>
    <div style="height: 450px; width: 850px;">
      <canvas #combinedKpiChart id="combinedKpiChart"></canvas>
    </div>
  </div>
</div>
